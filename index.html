<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Premier League + EFL Fixtures</title>
  <style>
    :root { --bg:#0b0f14; --card:#121a23; --text:#e7eef7; --muted:#9fb0c3; --line:#223040; --accent:#4aa3ff; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,15,20,.92);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .wrap{max-width:1000px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin-top:6px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    select,button{background:var(--card);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px 12px;font-size:14px}
    button{cursor:pointer;border-color:rgba(74,163,255,.45)}
    button:hover{background:rgba(74,163,255,.08)}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden}
    .head{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--line);vertical-align:top}
    th{font-size:12px;color:var(--muted);text-align:left}
    tr:hover td{background:rgba(255,255,255,.02)}
    .teams{font-weight:650}
    .meta{font-size:12px;color:var(--muted);margin-top:2px}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Premier League + EFL Fixtures</h1>
    <div class="sub">GitHub Pages frontend • Cloudflare Worker proxy • data from football-data.org (free PL + Championship)</div>
    <div class="bar">
      <select id="comp">
        <option value="PL">Premier League</option>
        <option value="ELC">EFL Championship</option>
        <option value="EL1">EFL League One (may require higher tier)</option>
        <option value="EL2">EFL League Two (may require higher tier)</option>
      </select>

      <select id="which">
        <option value="SCHEDULED" selected>Upcoming</option>
        <option value="FINISHED">Results</option>
      </select>

      <button id="load">Load</button>
      <span id="status" class="pill">Ready</span>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <div class="head">
      <div id="title" class="teams">—</div>
      <div id="count" class="meta">0 matches</div>
    </div>
    <table>
      <thead>
        <tr>
          <th style="width:220px;">Date / Time (UK)</th>
          <th>Match</th>
          <th style="width:120px;">Matchday</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="3" class="meta">Press Load.</td></tr>
      </tbody>
    </table>
  </div>

  <div class="meta" style="margin-top:12px;">
    If EL1/EL2 returns an error, that’s coverage/tier (PL + Championship are in the free tier). :contentReference[oaicite:1]{index=1}
  </div>
</div>

<script>
  // ✅ set this to your Cloudflare Worker URL (no trailing slash)
  const WORKER_BASE = "https://YOUR-WORKER.your-subdomain.workers.dev";

  const compSel = document.getElementById("comp");
  const whichSel = document.getElementById("which");
  const btn = document.getElementById("load");
  const statusEl = document.getElementById("status");
  const titleEl = document.getElementById("title");
  const countEl = document.getElementById("count");
  const rowsEl = document.getElementById("rows");

  function setStatus(t){ statusEl.textContent = t; }

  function ukTime(utcIso){
    const d = new Date(utcIso);
    return new Intl.DateTimeFormat("en-GB", {
      timeZone: "Europe/London",
      weekday: "short", year: "numeric", month: "short", day: "2-digit",
      hour: "2-digit", minute: "2-digit"
    }).format(d);
  }

  async function fetchViaWorker(targetUrl){
    const proxied = `${WORKER_BASE}?url=${encodeURIComponent(targetUrl)}`;
    const res = await fetch(proxied, { method: "GET" });
    const text = await res.text();

    let data;
    try { data = JSON.parse(text); }
    catch { throw new Error("Bad JSON from worker: " + text.slice(0,120)); }

    if (!res.ok) throw new Error(data?.message || data?.error || `HTTP ${res.status}`);
    return data;
  }

  function render(matches){
    if (!Array.isArray(matches) || matches.length === 0){
      rowsEl.innerHTML = `<tr><td colspan="3" class="meta">No matches returned for this filter.</td></tr>`;
      countEl.textContent = "0 matches";
      return;
    }

    matches.sort((a,b)=> new Date(a.utcDate) - new Date(b.utcDate));
    countEl.textContent = `${matches.length} match${matches.length===1?"":"es"}`;

    rowsEl.innerHTML = matches.map(m=>{
      const when = ukTime(m.utcDate);
      const home = m.homeTeam?.name || "—";
      const away = m.awayTeam?.name || "—";
      const md = (m.matchday ?? "—");
      return `
        <tr>
          <td>
            <div class="teams">${when}</div>
            <div class="meta">${m.status}</div>
          </td>
          <td>
            <div class="teams">${home} vs ${away}</div>
            <div class="meta">${m.stage || ""} ${m.group ? "• " + m.group : ""}</div>
          </td>
          <td><div class="teams">${md}</div></td>
        </tr>
      `;
    }).join("");
  }

  async function load(){
    const code = compSel.value;
    const status = whichSel.value;

    setStatus("Loading…");
    rowsEl.innerHTML = `<tr><td colspan="3" class="meta">Loading…</td></tr>`;

    try{
      // API docs show competitions can be addressed by code (PL, ELC, etc.). :contentReference[oaicite:2]{index=2}
      const url = `https://api.football-data.org/v4/competitions/${code}/matches?status=${encodeURIComponent(status)}`;
      const data = await fetchViaWorker(url);

      titleEl.textContent = `${data.competition?.name || code} (${code})`;
      render(data.matches);
      setStatus("Updated");
    }catch(e){
      titleEl.textContent = code;
      rowsEl.innerHTML = `<tr><td colspan="3" class="meta">Error: ${String(e.message || e)}</td></tr>`;
      setStatus("Error");
      console.error(e);
    }
  }

  btn.addEventListener("click", load);
  compSel.addEventListener("change", load);
  whichSel.addEventListener("change", load);

  load();
</script>
</body>
</html>
